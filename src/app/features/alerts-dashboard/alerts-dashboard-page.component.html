<div class="alerts-dashboard">
  <h2>アラート</h2>

  <div class="tabs">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'schedule'"
      (click)="setActiveTab('schedule')">
      届出スケジュール
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'suiji'"
      (click)="setActiveTab('suiji')">
      随時改定アラート
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'teiji'"
      (click)="setActiveTab('teiji')">
      定時決定（算定基礎届）
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'age'"
      (click)="setActiveTab('age')">
      年齢到達・資格変更
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'leave'"
      (click)="setActiveTab('leave')">
      産休・育休・休職
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'family'"
      (click)="setActiveTab('family')">
      扶養・氏名・住所変更
    </button>
  </div>

  <div class="tab-content">
    <!-- 届出スケジュール（マンスリーカレンダー）タブ -->
    <div *ngIf="activeTab === 'schedule'" class="tab-pane">
      <div class="card">
        <p class="info-text">届出スケジュール（マンスリーカレンダー）の実装は今後予定です。</p>
      </div>
    </div>

    <!-- 随時改定アラートタブ -->
    <div *ngIf="activeTab === 'suiji'" class="tab-pane">
      <div class="card">
        <div *ngIf="suijiAlerts.length === 0" class="info-label">
          随時改定候補はありません。
        </div>
        
        <div *ngIf="suijiAlerts.length > 0" style="margin-bottom: 1rem;">
          <button 
            *ngIf="selectedSuijiAlertIds.size > 0"
            (click)="deleteSelectedSuijiAlerts()"
            class="btn-danger"
            style="margin-right: 0.5rem;">
            選択した{{ selectedSuijiAlertIds.size }}件を削除（非表示にする）
          </button>
          <label style="margin-left: 1rem;">
            <input 
              type="checkbox" 
              [checked]="selectedSuijiAlertIds.size === suijiAlerts.length && suijiAlerts.length > 0"
              (change)="toggleAllSuijiAlertsChange($event)"
              style="margin-right: 0.5rem;">
            すべてのアラートを削除対象に選択
          </label>
        </div>
        
        <table class="alert-table" *ngIf="suijiAlerts.length > 0">
          <thead>
            <tr>
              <th style="width: 80px; text-align: center;">削除対象</th>
              <th>年度</th>
              <th>従業員</th>
              <th>変動月</th>
              <th>前月比</th>
              <th>前後3ヶ月平均</th>
              <th>現行等級</th>
              <th>新等級候補</th>
              <th>等級差</th>
              <th>適用開始月</th>
              <th>判定</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let alert of suijiAlerts; let i = index"
                [ngClass]="{
                  'alert-row': alert.isEligible,
                  'large-change-row': isLargeChange(alert.diff),
                  'selected-row': isSuijiAlertSelected(getSuijiAlertId(alert))
                }">
              <td style="width: 80px; text-align: center;">
                <input 
                  type="checkbox" 
                  [checked]="isSuijiAlertSelected(getSuijiAlertId(alert))"
                  (change)="toggleSuijiAlertSelection(getSuijiAlertId(alert))"
                  title="削除対象に選択">
              </td>
              <td>{{ alert.year || '-' }}年</td>
              <td>
                <span *ngIf="alert.isEligible">⚠️ </span>
                {{ getEmployeeName(alert.employeeId) }}
              </td>
              <td>{{ alert.changeMonth }}月</td>
              <td>
                <span *ngIf="alert.diffPrev != null">
                  {{ alert.diffPrev | number:'1.0-0' }}円
                </span>
                <span *ngIf="alert.diffPrev == null">-</span>
              </td>
              <td>{{ alert.averageSalary | number:'1.0-0' }}円</td>
              <td>{{ alert.currentGrade }}</td>
              <td>{{ alert.newGrade }}</td>
              <td>{{ alert.diff }}</td>
              <td>{{ alert.applyStartMonth }}月</td>
              <td>{{ getStatusText(alert) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 定時決定（算定基礎届）対象者一覧タブ -->
    <div *ngIf="activeTab === 'teiji'" class="tab-pane">
      <div class="card">
        <div style="max-width: 400px; margin-bottom: 1rem;">
          <div class="form-group">
            <label>年度：</label>
            <select [(ngModel)]="teijiYear" (change)="onTeijiYearChange()" class="form-control" [ngModelOptions]="{standalone: true}">
              <option *ngFor="let y of availableYears" [value]="y">{{ y }}年</option>
            </select>
          </div>
        </div>
        
        <h3>算定基礎届対象者一覧</h3>
        <p class="info-text" style="margin-bottom: 1rem;">
          支払基礎日数が17日以上の4〜6月の給与所得と平均額を表示します。<br>
          平均額との差が10%以上の月は算定除外月候補として表示されます。
        </p>
        
        <div *ngIf="teijiKetteiResults.length === 0" class="info-label">
          算定基礎届の対象者はありません。
        </div>
        
        <table class="alert-table" *ngIf="teijiKetteiResults.length > 0">
          <thead>
            <tr>
              <th>従業員</th>
              <th>4月給与</th>
              <th>4月支払基礎日数</th>
              <th>5月給与</th>
              <th>5月支払基礎日数</th>
              <th>6月給与</th>
              <th>6月支払基礎日数</th>
              <th>平均額</th>
              <th>算定除外月候補</th>
              <th>等級</th>
              <th>標準報酬月額</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let result of teijiKetteiResults"
                [ngClass]="{
                  'alert-row': result.exclusionCandidates.length > 0 || result.excludedMonths.length > 0
                }">
              <td>
                <span *ngIf="result.exclusionCandidates.length > 0">⚠️ </span>
                {{ result.employeeName }}
              </td>
              <td [ngClass]="{'exclusion-candidate': result.exclusionCandidates.includes(4)}">
                {{ result.aprilSalary | number:'1.0-0' }}円
                <span *ngIf="result.aprilWorkingDays < 17" style="color: #999; font-size: 0.9em;">(日数不足)</span>
              </td>
              <td>{{ result.aprilWorkingDays }}日</td>
              <td [ngClass]="{'exclusion-candidate': result.exclusionCandidates.includes(5)}">
                {{ result.maySalary | number:'1.0-0' }}円
                <span *ngIf="result.mayWorkingDays < 17" style="color: #999; font-size: 0.9em;">(日数不足)</span>
              </td>
              <td>{{ result.mayWorkingDays }}日</td>
              <td [ngClass]="{'exclusion-candidate': result.exclusionCandidates.includes(6)}">
                {{ result.juneSalary | number:'1.0-0' }}円
                <span *ngIf="result.juneWorkingDays < 17" style="color: #999; font-size: 0.9em;">(日数不足)</span>
              </td>
              <td>{{ result.juneWorkingDays }}日</td>
              <td><strong>{{ result.averageSalary | number:'1.0-0' }}円</strong></td>
              <td>
                <span *ngIf="result.exclusionCandidates.length > 0" style="color: #f57c00; font-weight: bold;">
                  ⚠️ {{ result.exclusionCandidates.join(', ') }}月
                </span>
                <span *ngIf="result.exclusionCandidates.length === 0">-</span>
              </td>
              <td>{{ result.teijiResult.grade > 0 ? result.teijiResult.grade + '等級' : '-' }}</td>
              <td>
                {{ result.teijiResult.standardMonthlyRemuneration > 0 
                  ? (result.teijiResult.standardMonthlyRemuneration | number:'1.0-0') + '円' 
                  : '-' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 年齢到達・資格変更アラートタブ -->
    <div *ngIf="activeTab === 'age'" class="tab-pane">
      <div class="card">
        <p class="info-text">年齢到達・資格変更アラートの実装は今後予定です。</p>
      </div>
    </div>

    <!-- 産休・育休・休職アラートタブ -->
    <div *ngIf="activeTab === 'leave'" class="tab-pane">
      <div class="card">
        <p class="info-text">産休・育休・休職アラートの実装は今後予定です。</p>
      </div>
    </div>

    <!-- 扶養・氏名・住所変更アラートタブ -->
    <div *ngIf="activeTab === 'family'" class="tab-pane">
      <div class="card">
        <p class="info-text">扶養・氏名・住所変更アラートの実装は今後予定です。</p>
      </div>
    </div>
  </div>
</div>

