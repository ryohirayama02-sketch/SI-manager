<div class="alerts-dashboard">
  <h2>アラート</h2>

  <div class="tabs">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'suiji'"
      (click)="setActiveTab('suiji')">
      随時改定アラート
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'notifications'"
      (click)="setActiveTab('notifications')">
      届出アラート
    </button>
  </div>

  <div class="tab-content">
    <div *ngIf="activeTab === 'suiji'" class="tab-pane">
      <div class="card" style="max-width: 400px; margin-bottom: 1rem;">
        <div class="form-group">
          <label>年度：</label>
          <select [(ngModel)]="year"
                  (change)="onYearChange()"
                  class="form-control"
                  [ngModelOptions]="{ standalone: true }">
            <option *ngFor="let y of availableYears" [value]="y">{{ y }}年</option>
          </select>
        </div>
      </div>

      <div class="card">
        <div *ngIf="suijiAlerts.length === 0" class="info-label">
          随時改定候補はありません。
        </div>
        
        <div *ngIf="suijiAlerts.length > 0" style="margin-bottom: 1rem;">
          <button 
            *ngIf="selectedSuijiAlertIds.size > 0"
            (click)="deleteSelectedSuijiAlerts()"
            class="btn-danger"
            style="margin-right: 0.5rem;">
            選択した{{ selectedSuijiAlertIds.size }}件を削除
          </button>
          <label style="margin-left: 1rem;">
            <input 
              type="checkbox" 
              [checked]="selectedSuijiAlertIds.size === suijiAlerts.length && suijiAlerts.length > 0"
              (change)="toggleAllSuijiAlertsChange($event)"
              style="margin-right: 0.5rem;">
            すべて選択
          </label>
        </div>
        
        <table class="alert-table" *ngIf="suijiAlerts.length > 0">
          <thead>
            <tr>
              <th style="width: 40px;"></th>
              <th>従業員</th>
              <th>変動月</th>
              <th>前月比</th>
              <th>前後3ヶ月平均</th>
              <th>現行等級</th>
              <th>新等級候補</th>
              <th>等級差</th>
              <th>適用開始月</th>
              <th>判定</th>
              <th>理由</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let alert of suijiAlerts; let i = index"
                [ngClass]="{
                  'alert-row': alert.isEligible,
                  'large-change-row': isLargeChange(alert.diff)
                }">
              <td style="width: 40px;">
                <input 
                  type="checkbox" 
                  [checked]="isSuijiAlertSelected(getSuijiAlertId(alert))"
                  (change)="toggleSuijiAlertSelection(getSuijiAlertId(alert))">
              </td>
              <td>
                <span *ngIf="alert.isEligible">⚠️ </span>
                {{ getEmployeeName(alert.employeeId) }}
              </td>
              <td>{{ alert.changeMonth }}月</td>
              <td>
                <span *ngIf="alert.diffPrev != null">
                  {{ alert.diffPrev | number:'1.0-0' }}円
                </span>
                <span *ngIf="alert.diffPrev == null">-</span>
              </td>
              <td>{{ alert.averageSalary | number:'1.0-0' }}円</td>
              <td>{{ alert.currentGrade }}</td>
              <td>{{ alert.newGrade }}</td>
              <td>{{ alert.diff }}</td>
              <td>{{ alert.applyStartMonth }}月</td>
              <td>{{ getStatusText(alert) }}</td>
              <td>{{ getReasonText(alert) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div *ngIf="activeTab === 'notifications'" class="tab-pane">
      <app-alert-item-list 
        [alerts]="notificationAlerts"
        [selectedAlertIds]="selectedNotificationAlertIds"
        [onToggleSelection]="toggleNotificationAlertSelection.bind(this)"
        [onToggleAll]="toggleAllNotificationAlerts.bind(this)"
        [onDeleteSelected]="deleteSelectedNotificationAlerts.bind(this)"
        [isSelected]="isNotificationAlertSelected.bind(this)">
      </app-alert-item-list>
    </div>
  </div>
</div>

