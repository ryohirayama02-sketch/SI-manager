<div class="form-section" [formGroup]="form">
  <h3>標準報酬</h3>

  <!-- 月次報酬入力画面からの自動算出結果（参考情報） -->
  <div
    class="card"
    style="margin-bottom: 1.5rem; padding: 1rem; background-color: #f8f9fa"
  >
    <h4 style="margin-top: 0">
      月次報酬入力画面からの自動算出結果（参考情報）
    </h4>
    <div style="display: flex; gap: 1rem; margin-bottom: 1rem">
      <button
        type="button"
        (click)="loadCalculationResults(); applyLatestResult()"
        class="btn-secondary"
        [disabled]="isLoading"
      >
        {{ isLoading ? "読み込み中..." : "計算結果を更新" }}
      </button>
    </div>

    <!-- 定時決定の結果 -->
    <div
      *ngIf="teijiResult"
      style="
        margin-bottom: 1rem;
        padding: 0.75rem;
        background-color: white;
        border-radius: 4px;
        border: 1px solid #ddd;
      "
    >
      <h5 style="margin-top: 0">定時決定（{{ currentYear }}年度）</h5>
      <div style="font-size: 0.9rem; margin-bottom: 0.5rem">
        <div>
          <strong>標準報酬月額:</strong>
          {{ teijiResult.standardMonthlyRemuneration.toLocaleString() }}円
        </div>
        <div><strong>等級:</strong> {{ teijiResult.grade }}</div>
        <div>
          <strong>4〜6月平均:</strong>
          {{ teijiResult.averageSalary.toLocaleString() }}円
        </div>
        <div>
          <strong>使用月:</strong> {{ teijiResult.usedMonths.join("・") }}月
        </div>
        <div>
          <strong>適用開始:</strong>
          {{ teijiResult.startApplyYearMonth?.year || currentYear }}年{{
            teijiResult.startApplyYearMonth?.month || 9
          }}月
        </div>
        <div
          *ngIf="teijiResult.excludedMonths.length > 0"
          style="color: #dc3545"
        >
          <strong>算定除外月:</strong>
          {{ teijiResult.excludedMonths.join("・") }}月
        </div>
        <div style="margin-top: 0.5rem; font-size: 0.85rem; color: #666">
          <strong>理由:</strong>
          <ul style="margin: 0.25rem 0 0 1.5rem; padding: 0">
            <li *ngFor="let reason of teijiResult.reasons">{{ reason }}</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- 随時改定の結果（最新の1つだけ表示） -->
    <div
      *ngIf="latestSuijiResult"
      style="
        margin-bottom: 1rem;
        padding: 0.75rem;
        background-color: white;
        border-radius: 4px;
        border: 1px solid #ddd;
      "
    >
      <h5 style="margin-top: 0">随時改定（最新）</h5>
      <div style="font-size: 0.9rem; margin-bottom: 0.5rem">
        <div>
          <strong>年度:</strong> {{ getSuijiYear(latestSuijiResult) }}年度
        </div>
        <div>
          <strong>変動月:</strong> {{ latestSuijiResult.changeMonth }}月
        </div>
        <div><strong>新等級:</strong> {{ latestSuijiResult.newGrade }}</div>
        <div>
          <strong>現行等級:</strong> {{ latestSuijiResult.currentGrade }}
        </div>
        <div><strong>等級差:</strong> {{ latestSuijiResult.diff }}</div>
        <div>
          <strong>適用開始月:</strong> {{ latestSuijiResult.applyStartMonth }}月
        </div>
        <div>
          <strong>3ヶ月平均:</strong>
          {{ latestSuijiResult.averageSalary.toLocaleString() }}円
        </div>
      </div>
    </div>

    <div
      *ngIf="!teijiResult && !latestSuijiResult && !isLoading"
      style="color: #666; font-size: 0.9rem"
    >
      月次報酬入力画面で給与データを入力すると、ここに定時決定・随時改定の結果が表示されます。
    </div>
  </div>

  <!-- 手動入力欄 -->
  <div class="form-group">
    <label for="currentStandardMonthlyRemuneration">現在の標準報酬月額（自動計算・確認用）</label>
    <input
      id="currentStandardMonthlyRemuneration"
      type="number"
      formControlName="currentStandardMonthlyRemuneration"
      class="form-control"
      min="0"
      placeholder="円"
      readonly
    />
  </div>

  <div class="form-group">
    <label for="determinationReason">決定理由</label>
    <input
      id="determinationReason"
      type="text"
      [value]="getDeterminationReasonLabel()"
      class="form-control"
      readonly
      style="background-color: #f5f5f5; cursor: not-allowed;"
    />
    <!-- フォームの値として保持するため、hidden inputで値を保持 -->
    <input
      type="hidden"
      formControlName="determinationReason"
    />
  </div>

</div>
