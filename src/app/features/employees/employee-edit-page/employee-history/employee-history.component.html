<h3>標準報酬履歴・社保加入履歴</h3>

<div style="margin-bottom: 1rem; display: flex; align-items: center; gap: 1rem">
  <div>
    <label for="historyYear">表示年度:</label>
    <select
      id="historyYear"
      [ngModel]="selectedHistoryYear"
      (ngModelChange)="onHistoryYearChange($event)"
      class="form-control"
      style="display: inline-block; width: auto; margin-left: 0.5rem"
    >
      <option *ngFor="let year of availableHistoryYears" [value]="year">
        {{ year }}年
      </option>
    </select>
  </div>
  <button
    type="button"
    class="btn-primary"
    (click)="updateHistory()"
    [disabled]="isUpdatingHistory"
    style="margin-left: auto"
  >
    {{ isUpdatingHistory ? "更新中..." : "更新" }}
  </button>
</div>

<p *ngIf="isLoadingHistories" class="info-text">読み込み中...</p>
<table
  class="table"
  *ngIf="
    !isLoadingHistories &&
    mergedHistories.length > 0 &&
    !(
      joinYear !== null &&
      joinYear !== undefined &&
      selectedHistoryYear < joinYear
    )
  "
>
  <thead>
    <tr>
      <th>年月</th>
      <th>標準報酬等級</th>
      <th>標準報酬月額</th>
      <th>決定理由</th>
      <th>年齢</th>
      <th>健康保険</th>
      <th>介護保険</th>
      <th>厚生年金</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of mergedHistories">
      <td>{{ item.year }}年{{ item.month }}月</td>
      <td>{{ item.grade !== null ? item.grade + "等級" : "-" }}</td>
      <td>
        {{
          item.standardMonthlyRemuneration !== null
            ? (item.standardMonthlyRemuneration | number : "1.0-0") + "円"
            : "-"
        }}
      </td>
      <td>{{ item.determinationReason || "-" }}</td>
      <td>{{ item.age !== null ? item.age + "歳" : "-" }}</td>
      <td>{{ item.healthInsurance }}</td>
      <td>{{ item.careInsurance }}</td>
      <td>{{ item.pensionInsurance }}</td>
    </tr>
  </tbody>
</table>
<p
  *ngIf="
    !isLoadingHistories &&
    joinYear !== null &&
    joinYear !== undefined &&
    selectedHistoryYear < joinYear
  "
  class="info-text"
>
  入社前です。
</p>
<p
  *ngIf="
    !isLoadingHistories &&
    mergedHistories.length === 0 &&
    !(
      joinYear !== null &&
      joinYear !== undefined &&
      selectedHistoryYear < joinYear
    )
  "
  class="info-text"
>
  履歴が登録されていません。履歴は自動的に生成されます。
</p>
