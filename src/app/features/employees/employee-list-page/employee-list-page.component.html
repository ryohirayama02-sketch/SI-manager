<h2>従業員一覧</h2>

<!-- タブナビゲーション -->
<div class="tabs">
  <button 
    type="button"
    class="tab-button" 
    [class.active]="activeTab === 'all'"
    (click)="activeTab = 'all'">
    全従業員
  </button>
  <button 
    type="button"
    class="tab-button" 
    [class.active]="activeTab === 'onLeave'"
    (click)="activeTab = 'onLeave'">
    休業者一覧
  </button>
</div>

<div class="card" style="margin-bottom: 1rem;">
  <div style="display: flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
    <button (click)="goCreate()" class="btn-primary btn-create">
      ＋ 新規登録
    </button>
    
    <div style="display: flex; gap: 1rem; align-items: center;">
      <label>
        名前検索：
        <input type="text" [(ngModel)]="filterName" placeholder="名前で検索" class="form-control" style="width: 200px;">
      </label>
      
      <label *ngIf="activeTab === 'all'">
        対象区分：
        <select [(ngModel)]="filterEligibilityStatus" class="form-control" style="width: 150px;">
          <option value="all">すべて</option>
          <option value="eligible">加入対象</option>
          <option value="short-time">短時間対象</option>
          <option value="non-eligible">非対象</option>
          <option value="candidate">加入候補</option>
        </select>
      </label>
    </div>
  </div>
</div>

<div class="card">
  <!-- 全従業員タブのテーブル -->
  <table *ngIf="activeTab === 'all'" class="employee-table" style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th>名前</th>
        <th>加入判定</th>
        <th>健康保険<br>加入状況</th>
        <th>介護保険<br>加入状況</th>
        <th>厚生年金<br>加入状況</th>
        <th>標準報酬</th>
        <th>健康保険 本人/会社</th>
        <th>介護保険 本人/会社</th>
        <th>厚生年金 本人/会社</th>
        <th>合計</th>
        <th>備考</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let info of getFilteredEmployees()" 
          (click)="goDetail(info.employee.id)" 
          style="cursor: pointer;"
          [ngClass]="{ 'candidate-row': isCandidate(info) }">
        <td>
          <span *ngIf="isCandidate(info)" style="color: #ff6b00; font-weight: bold;">⚠️ </span>
          {{ info.employee.name }}
        </td>
        <td [title]="eligibilityDescriptions[getEligibilityCategory(info)]">
          <span [ngClass]="{ 'candidate-badge': isCandidate(info) }">
            {{ getEligibilityStatusLabel(info) }}
          </span>
        </td>
        <td>{{ getHealthInsuranceStatus(info) }}</td>
        <td>{{ getCareInsuranceStatus(info) }}</td>
        <td>{{ getPensionStatus(info) }}</td>
        <td>{{ getStandardMonthlyRemunerationDisplay(info) }}</td>
        <td>
          <span *ngIf="monthlyPremiumSummary[info.employee.id]">
            {{ monthlyPremiumSummary[info.employee.id].healthEmployee | number:'1.0-0' }} / {{ monthlyPremiumSummary[info.employee.id].healthEmployer | number:'1.0-0' }}
          </span>
          <span *ngIf="!monthlyPremiumSummary[info.employee.id]">-</span>
        </td>
        <td>
          <span *ngIf="monthlyPremiumSummary[info.employee.id]">
            {{ monthlyPremiumSummary[info.employee.id].careEmployee | number:'1.0-0' }} / {{ monthlyPremiumSummary[info.employee.id].careEmployer | number:'1.0-0' }}
          </span>
          <span *ngIf="!monthlyPremiumSummary[info.employee.id]">-</span>
        </td>
        <td>
          <span *ngIf="monthlyPremiumSummary[info.employee.id]">
            {{ monthlyPremiumSummary[info.employee.id].pensionEmployee | number:'1.0-0' }} / {{ monthlyPremiumSummary[info.employee.id].pensionEmployer | number:'1.0-0' }}
          </span>
          <span *ngIf="!monthlyPremiumSummary[info.employee.id]">-</span>
        </td>
        <td>
          <span *ngIf="monthlyPremiumSummary[info.employee.id]">
            {{ monthlyPremiumSummary[info.employee.id].total | number:'1.0-0' }}
          </span>
          <span *ngIf="!monthlyPremiumSummary[info.employee.id]">-</span>
        </td>
        <td>
          <span *ngFor="let note of info.notes; let last = last">
            {{ note }}<span *ngIf="!last">、</span>
          </span>
          <span *ngIf="info.notes.length === 0">-</span>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- 休業者一覧タブのテーブル -->
  <table *ngIf="activeTab === 'onLeave'" class="employee-table" style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr>
        <th>名前</th>
        <th>休業ステータス</th>
        <th>産前産後休業<br>開始日</th>
        <th>産前産後休業<br>終了日</th>
        <th>育児休業<br>開始日</th>
        <th>育児休業<br>終了日</th>
        <th>無給休職<br>開始日</th>
        <th>無給休職<br>終了日</th>
        <th>健保・厚年<br>保険料免除</th>
        <th>徴収不能<br>アラート</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let info of getFilteredEmployees()" 
          (click)="goDetail(info.employee.id)" 
          style="cursor: pointer;">
        <td>{{ info.employee.name }}</td>
        <td>
          <span *ngIf="info.leaveStatus">
            {{ getLeaveStatusLabel(info.leaveStatus.status) }}
          </span>
          <span *ngIf="!info.leaveStatus">-</span>
        </td>
        <td>{{ info.employee.maternityLeaveStart || '-' }}</td>
        <td>{{ info.employee.maternityLeaveEnd || '-' }}</td>
        <td>{{ info.employee.childcareLeaveStart || '-' }}</td>
        <td>{{ info.employee.childcareLeaveEnd || '-' }}</td>
        <td>{{ info.employee.leaveOfAbsenceStart || '-' }}</td>
        <td>{{ info.employee.leaveOfAbsenceEnd || info.employee.returnFromLeaveDate || '-' }}</td>
        <td>
          <span *ngIf="info.leaveStatus && (info.leaveStatus.status === 'maternity' || info.leaveStatus.status === 'childcare')" style="color: #28a745; font-weight: bold;">
            免除
          </span>
          <span *ngIf="!info.leaveStatus || (info.leaveStatus.status !== 'maternity' && info.leaveStatus.status !== 'childcare')">-</span>
        </td>
        <td>
          <span *ngIf="info.hasCollectionImpossibleAlert" style="color: #dc3545; font-weight: bold;">
            ⚠️ 徴収不能
          </span>
          <span *ngIf="!info.hasCollectionImpossibleAlert">-</span>
        </td>
      </tr>
    </tbody>
  </table>
  
  <div *ngIf="getFilteredEmployees().length === 0" style="padding: 2rem; text-align: center;">
    該当する従業員がありません
  </div>
</div>


