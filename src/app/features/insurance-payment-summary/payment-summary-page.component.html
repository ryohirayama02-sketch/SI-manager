<h2>{{ year }}å¹´ ç¤¾ä¼šä¿é™ºæ–™ æŒ¯è¾¼é¡ä¸€è¦§</h2>

<!-- å¹´é–“è­¦å‘Šãƒ‘ãƒãƒ« -->
<div class="warning-panel" *ngIf="warnings.length > 0">
  <h3>âš ï¸ å¹´é–“è­¦å‘Š</h3>
  <div *ngFor="let w of warnings" class="warning-item">âš ï¸ {{ w }}</div>
</div>

<!-- TODO: éå»å¹´åº¦ã®é›†è¨ˆã«ã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†ã« year ã‚»ãƒ¬ã‚¯ã‚¿ã‚’è¿½åŠ ã™ã‚‹ -->

<!-- ä¼šç¤¾å…¨ä½“ã®å¹´é–“ä¿é™ºæ–™åˆè¨ˆï¼ˆæœ¬äººåˆ†ï¼‹ä¼šç¤¾è² æ‹…åˆ†ï¼‰ -->
<div
  class="card"
  *ngIf="employees.length > 0 && companyMonthlyTotals.length > 0"
>
  <h3>å¹´é–“ä¿é™ºæ–™åˆè¨ˆï¼ˆ{{ year }}å¹´åº¦ï¼‰</h3>
  <table class="payment-table annual-summary-table">
    <thead>
      <tr>
        <th>é …ç›®</th>
        <th>é‡‘é¡</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="label-cell">å¥åº·ä¿é™º</td>
        <td class="amount-cell">
          {{ getAnnualTotalHealth() | number : "1.0-0" }}å††
        </td>
      </tr>
      <tr>
        <td class="label-cell">ä»‹è­·ä¿é™º</td>
        <td class="amount-cell">
          {{ getAnnualTotalCare() | number : "1.0-0" }}å††
        </td>
      </tr>
      <tr>
        <td class="label-cell">åšç”Ÿå¹´é‡‘</td>
        <td class="amount-cell">
          {{ getAnnualTotalPension() | number : "1.0-0" }}å††
        </td>
      </tr>
      <tr>
        <td class="label-cell">è³ä¸ä¿é™ºæ–™ï¼ˆå¾“æ¥­å“¡ï¼‰</td>
        <td class="amount-cell">
          {{ bonusAnnualTotals.totalEmployee | number : "1.0-0" }}å††
        </td>
      </tr>
      <tr>
        <td class="label-cell">è³ä¸ä¿é™ºæ–™ï¼ˆäº‹æ¥­ä¸»ï¼‰</td>
        <td class="amount-cell">
          {{ bonusAnnualTotals.totalEmployer | number : "1.0-0" }}å††
        </td>
      </tr>
      <tr class="total-row">
        <td class="label-cell total-cell">å¹´é–“åˆè¨ˆï¼ˆçµ¦ä¸ï¼‹è³ä¸ï¼‰</td>
        <td class="amount-cell total-cell">
          {{ getAnnualTotal() + bonusAnnualTotals.total | number : "1.0-0" }}å††
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div *ngIf="employees.length === 0" class="no-data-message">
  <p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
</div>

<!-- ã‚¨ãƒ©ãƒ¼ãƒ»è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå¾“æ¥­å“¡ã”ã¨ï¼‰ -->
<div *ngFor="let emp of employees">
  <div *ngIf="errorMessages[emp.id]?.length" class="error-box">
    <h4>ã‚¨ãƒ©ãƒ¼ï¼ˆ{{ emp.name }}ï¼‰</h4>
    <ul>
      <li *ngFor="let err of errorMessages[emp.id] ?? []">{{ err }}</li>
    </ul>
  </div>

  <div *ngIf="warningMessages[emp.id]?.length" class="warning-box">
    <h4>è­¦å‘Šï¼ˆ{{ emp.name }}ï¼‰</h4>
    <ul>
      <li *ngFor="let w of warningMessages[emp.id] ?? []">{{ w }}</li>
    </ul>
  </div>
</div>

<div class="card" *ngIf="employees.length > 0">
  <h3>ä¼šç¤¾å…¨ä½“ã®æœˆæ¬¡åˆè¨ˆï¼ˆ{{ year }}å¹´åº¦ï¼‰</h3>
  <table class="payment-table">
    <thead>
      <tr>
        <th>æœˆ</th>
        <th>å¥åº·ä¿é™º</th>
        <th>ä»‹è­·ä¿é™º</th>
        <th>åšç”Ÿå¹´é‡‘</th>
        <th>åˆè¨ˆ</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let month of months"
        [class.bonus-month-row]="bonusByMonth[month]"
      >
        <td class="month-cell">
          {{ month }}æœˆ
          <span *ngIf="bonusByMonth[month]" class="bonus-mark">â˜…</span>
          <span
            *ngIf="bonusByMonth[month]"
            class="bonus-info"
            [title]="getBonusTooltip(month)"
            >â„¹ï¸</span
          >
          <div *ngIf="monthlyTotals[month]?.isRetired" class="stop-info">
            <small>è³‡æ ¼å–ªå¤±æœˆï¼šä¿é™ºæ–™ãªã—</small>
          </div>
          <div *ngIf="monthlyTotals[month]?.isPensionStopped" class="stop-info">
            <small>åšç”Ÿå¹´é‡‘ï¼š70æ­³åˆ°é”ã®ãŸã‚å…é™¤</small>
          </div>
          <div *ngIf="monthlyTotals[month]?.isHealthStopped" class="stop-info">
            <small>å¥ä¿ãƒ»ä»‹ä¿ï¼š75æ­³åˆ°é”ã®ãŸã‚å…é™¤</small>
          </div>
          <div *ngIf="monthlyTotals[month]?.isMaternityLeave" class="stop-info">
            <small>ç”£ä¼‘ï¼šæœ¬äººè² æ‹…å…é™¤</small>
          </div>
          <div *ngIf="monthlyTotals[month]?.isChildcareLeave" class="stop-info">
            <small>è‚²ä¼‘ï¼šæœ¬äººè² æ‹…å…é™¤</small>
          </div>
        </td>
        <td class="amount-cell">
          {{ monthlyTotals[month]?.health ?? 0 | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell">
          {{ monthlyTotals[month]?.care ?? 0 | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell">
          {{ monthlyTotals[month]?.pension ?? 0 | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell total-cell">
          {{ monthlyTotals[month]?.total ?? 0 | number : "1.0-0" }}å††
        </td>
      </tr>
    </tbody>
    <tfoot>
      <tr class="total-row">
        <td class="month-cell">å¹´é–“åˆè¨ˆ</td>
        <td class="amount-cell total-cell">
          {{ getTotalHealth() | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell total-cell">
          {{ getTotalCare() | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell total-cell">
          {{ getTotalPension() | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell total-cell">
          {{ getTotalForYear() | number : "1.0-0" }}å††
        </td>
      </tr>
    </tfoot>
  </table>
</div>

<!-- ä¼šç¤¾å…¨ä½“ã®æœˆæ¬¡ä¿é™ºæ–™åˆè¨ˆï¼ˆæœ¬äººåˆ†ï¼‹ä¼šç¤¾è² æ‹…åˆ†ï¼‰ -->
<div
  class="card"
  *ngIf="employees.length > 0 && companyMonthlyTotals.length > 0"
>
  <h3>ä¼šç¤¾å…¨ä½“ã®æœˆæ¬¡ä¿é™ºæ–™åˆè¨ˆï¼ˆæœ¬äººåˆ†ï¼‹ä¼šç¤¾è² æ‹…åˆ†ï¼‰ï¼ˆ{{ year }}å¹´åº¦ï¼‰</h3>
  <table class="payment-table">
    <thead>
      <tr>
        <th>æœˆ</th>
        <th>å¥åº·ä¿é™º</th>
        <th>ä»‹è­·ä¿é™º</th>
        <th>åšç”Ÿå¹´é‡‘</th>
        <th>åˆè¨ˆ</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let total of companyMonthlyTotals"
        [class.bonus-month-row]="bonusByMonth[total.month]"
      >
        <td class="month-cell">
          {{ total.month }}æœˆ
          <span *ngIf="bonusByMonth[total.month]" class="bonus-mark">â˜…</span>
          <span
            *ngIf="bonusByMonth[total.month]"
            class="bonus-info"
            [title]="getBonusTooltip(total.month)"
            >â„¹ï¸</span
          >
          <div *ngIf="monthlyTotals[total.month]?.isRetired" class="stop-info">
            <small>è³‡æ ¼å–ªå¤±æœˆï¼šä¿é™ºæ–™ãªã—</small>
          </div>
          <div
            *ngIf="monthlyTotals[total.month]?.isPensionStopped"
            class="stop-info"
          >
            <small>åšç”Ÿå¹´é‡‘ï¼š70æ­³åˆ°é”ã®ãŸã‚å…é™¤</small>
          </div>
          <div
            *ngIf="monthlyTotals[total.month]?.isHealthStopped"
            class="stop-info"
          >
            <small>å¥ä¿ãƒ»ä»‹ä¿ï¼š75æ­³åˆ°é”ã®ãŸã‚å…é™¤</small>
          </div>
          <div
            *ngIf="monthlyTotals[total.month]?.isMaternityLeave"
            class="stop-info"
          >
            <small>ç”£ä¼‘ï¼šæœ¬äººè² æ‹…å…é™¤</small>
          </div>
          <div
            *ngIf="monthlyTotals[total.month]?.isChildcareLeave"
            class="stop-info"
          >
            <small>è‚²ä¼‘ï¼šæœ¬äººè² æ‹…å…é™¤</small>
          </div>
        </td>
        <td class="amount-cell">
          {{ total.healthTotal | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell">{{ total.careTotal | number : "1.0-0" }}å††</td>
        <td class="amount-cell">
          {{ total.pensionTotal | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell total-cell">
          {{ total.total | number : "1.0-0" }}å††
        </td>
      </tr>
    </tbody>
    <tfoot>
      <tr class="total-row">
        <td class="month-cell">å¹´é–“åˆè¨ˆ</td>
        <td class="amount-cell total-cell">
          {{ getCompanyTotalHealth() | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell total-cell">
          {{ getCompanyTotalCare() | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell total-cell">
          {{ getCompanyTotalPension() | number : "1.0-0" }}å††
        </td>
        <td class="amount-cell total-cell">
          {{ getCompanyTotal() | number : "1.0-0" }}å††
        </td>
      </tr>
    </tfoot>
  </table>
</div>

<!-- å¾“æ¥­å“¡ã”ã¨ã®æœˆæ¬¡å ±é…¬ä¿é™ºæ–™ -->
<div *ngFor="let emp of employees" class="card monthly-section">
  <h4>æœˆæ¬¡å ±é…¬ä¿é™ºæ–™ï¼ˆ{{ emp.name }} - {{ year }}å¹´åº¦ï¼‰</h4>

  <table
    class="monthly-table"
    *ngIf="monthlyPremiumsByEmployee[emp.id]?.length"
  >
    <thead>
      <tr>
        <th>æœˆ</th>
        <th>å¥ä¿ï¼ˆæœ¬äººï¼‰</th>
        <th>å¥ä¿ï¼ˆä¼šç¤¾ï¼‰</th>
        <th>ä»‹ä¿ï¼ˆæœ¬äººï¼‰</th>
        <th>ä»‹ä¿ï¼ˆä¼šç¤¾ï¼‰</th>
        <th>åšå¹´ï¼ˆæœ¬äººï¼‰</th>
        <th>åšå¹´ï¼ˆä¼šç¤¾ï¼‰</th>
        <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of monthlyPremiumsByEmployee[emp.id]">
        <td>
          {{ row.month }}æœˆ
          <div *ngIf="row.isAcquisitionMonth" class="acquire-info">
            è³‡æ ¼å–å¾—æ™‚æ±ºå®šï¼š{{ row.acquisitionGrade }}ç­‰ç´šï¼ˆæ¨™æº–å ±é…¬
            {{
              (row.acquisitionStandard ?? 0) / 10000 | number : "1.0-1"
            }}ä¸‡å††ï¼‰
            <div
              *ngIf="row.acquisitionReason"
              class="acquire-reason"
              [title]="row.acquisitionReason"
            >
              ğŸ’¡ èª¬æ˜ã‚’è¡¨ç¤º
            </div>
            <div *ngIf="row.shikakuReportRequired" class="shikaku-report">
              ğŸ“„ è³‡æ ¼å–å¾—å±Šï¼šæå‡ºå¿…è¦ï¼ˆæœŸé™ {{ row.shikakuReportDeadline }}ï¼‰
            </div>
            <div
              *ngIf="
                !row.shikakuReportRequired &&
                row.shikakuReportRequired !== undefined
              "
              class="shikaku-report"
            >
              ğŸ“„ è³‡æ ¼å–å¾—å±Šï¼šæå‡ºä¸è¦
            </div>
          </div>
        </td>
        <td>{{ row.healthEmployee | number : "1.0-0" }}å††</td>
        <td>{{ row.healthEmployer | number : "1.0-0" }}å††</td>
        <td>{{ row.careEmployee | number : "1.0-0" }}å††</td>
        <td>{{ row.careEmployer | number : "1.0-0" }}å††</td>
        <td>{{ row.pensionEmployee | number : "1.0-0" }}å††</td>
        <td>{{ row.pensionEmployer | number : "1.0-0" }}å††</td>
        <td>
          <span *ngIf="row.exempt" class="badge-exempt">å…é™¤</span>
          <span *ngIf="!row.exempt && row.notes?.length" class="badge-warning"
            >æ³¨æ„</span
          >
        </td>
      </tr>
    </tbody>
  </table>

  <p *ngIf="!monthlyPremiumsByEmployee[emp.id]?.length">
    æœˆæ¬¡çµ¦ä¸ãƒ‡ãƒ¼ã‚¿ãŒæœªç™»éŒ²ã®ãŸã‚ã€ä¿é™ºæ–™ã‚’è¨ˆç®—ã§ãã¾ã›ã‚“ã€‚
  </p>

  <div class="info-label" *ngIf="hasNotesForEmployee(emp.id)">
    <span>â€» è©³ç´°ãªå…é™¤ç†ç”±ãƒ»æ³¨æ„äº‹é …ã¯å„æœˆã® notes ã‚’å‚ç…§</span>
  </div>

  <!-- å±Šå‡ºè¦å¦ -->
  <div
    class="notification-block"
    *ngIf="notificationsByEmployee[emp.id]?.length"
  >
    <h4>å±Šå‡ºè¦å¦</h4>
    <div
      *ngFor="let n of notificationsByEmployee[emp.id]"
      class="notification-item"
    >
      <div class="notification-header">
        <span class="notification-type">{{
          getNotificationTypeLabel(n.type)
        }}</span>
        <span
          class="notification-required"
          [class.required]="n.required"
          [class.not-required]="!n.required"
        >
          {{ n.required ? "è¦æå‡º" : "ä¸è¦" }}
        </span>
      </div>
      <div *ngIf="n.submitUntil" class="notification-deadline">
        æå‡ºæœŸé™: {{ n.submitUntil }}
      </div>
      <ul class="notification-reasons">
        <li *ngFor="let r of n.reasons">{{ r }}</li>
      </ul>
    </div>
  </div>
</div>
