<!-- ローディングインジケータ -->
<app-loading-indicator
  [isLoading]="isLoading"
  message="集計中..."
></app-loading-indicator>

<!-- スクロールトップボタン -->
<app-scroll-to-top></app-scroll-to-top>

<!-- ヘッダー -->
<app-payment-summary-header [year]="year"></app-payment-summary-header>

<!-- 年度選択 -->
<app-payment-summary-year-selector
  [year]="year"
  (yearChange)="onYearChange($event)"
></app-payment-summary-year-selector>

<!-- 従業員セレクタ -->
<app-payment-summary-employee-selector
  [employees]="employees"
  [selectedEmployeeIds]="selectedEmployeeIds"
  (selectionChange)="onEmployeeSelectionChange($event)"
></app-payment-summary-employee-selector>

<!-- 年間警告パネル -->
<app-annual-warning-panel [warnings]="warnings"></app-annual-warning-panel>

<!-- 会社全体の年間保険料合計（本人分＋会社負担分） -->
<app-annual-bonus-summary
  [year]="year"
  [bonusAnnualTotals]="bonusAnnualTotals"
  [annualTotalHealth]="annualTotals.health"
  [annualTotalCare]="annualTotals.care"
  [annualTotalPension]="annualTotals.pension"
  [annualTotal]="annualTotals.total"
></app-annual-bonus-summary>

<div *ngIf="employees.length === 0" class="no-data-message">
  <p>データがありません</p>
</div>

<!-- エラー・警告メッセージ（従業員ごと） -->
<app-error-panel
  [employees]="getFilteredEmployees()"
  [errorMessages]="errorMessages"
  [warningMessages]="warningMessages"
></app-error-panel>

<!-- 会社全体の月次保険料合計（本人分＋会社負担分） -->
<app-company-monthly-total-table
  [year]="year"
  [companyMonthlyTotals]="companyMonthlyTotals"
  [bonusByMonth]="bonusByMonth"
  [monthlyTotals]="monthlyTotals"
  [getBonusTooltip]="getBonusTooltip.bind(this)"
  [annualTotalHealth]="annualTotals.health"
  [annualTotalCare]="annualTotals.care"
  [annualTotalPension]="annualTotals.pension"
  [annualTotal]="annualTotals.total"
></app-company-monthly-total-table>

<!-- 従業員ごとの月次報酬保険料 -->
<app-monthly-premium-table
  *ngFor="let emp of getFilteredEmployees()"
  [employee]="emp"
  [year]="year"
  [monthlyPremiumRows]="monthlyPremiumsByEmployee[emp.id] || []"
  [hasNotes]="hasNotesForEmployee(emp.id)"
></app-monthly-premium-table>

<!-- 従業員ごとの届出要否 -->
<app-employee-notification-panel
  *ngFor="let emp of getFilteredEmployees()"
  [employee]="emp"
  [notifications]="notificationsByEmployee[emp.id] || []"
  [getNotificationTypeLabel]="getNotificationTypeLabel.bind(this)"
></app-employee-notification-panel>
