<h2>社会保険料計算結果</h2>

<div class="card" style="margin-bottom: 1rem;">
  <div style="display: flex; gap: 1rem;">
    <div class="form-group">
      <label>年度：</label>
      <select [(ngModel)]="year" (change)="onYearChange()" class="form-control" [ngModelOptions]="{standalone: true}">
        <option *ngFor="let y of availableYears" [value]="y">{{ y }}年</option>
      </select>
    </div>
    <div class="form-group">
      <label>月：</label>
      <select [(ngModel)]="selectedMonth" (change)="onMonthChange()" class="form-control" [ngModelOptions]="{standalone: true}">
        <option value="all">全月（1-12）</option>
        <option *ngFor="let m of [1,2,3,4,5,6,7,8,9,10,11,12]" [value]="m">{{ m }}月</option>
      </select>
    </div>
  </div>
</div>

<div class="info-label">
  免除・給与扱いは自動判定されます。70歳以上は厚生年金、75歳以上は健康保険・介護保険が停止されます。
</div>

<div *ngIf="employees.length === 0" class="no-data-message">
  <p>データがありません</p>
</div>

<div *ngIf="employees.length > 0" class="card">
  <h3>社会保険料計算結果（{{ year }}年度{{ getMonthLabel() }}）</h3>
  
  <table class="premium-table" style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
    <thead>
      <tr>
        <th>氏名</th>
        <th>健康保険<br>本人/会社</th>
        <th>介護保険<br>本人/会社</th>
        <th>厚生年金<br>本人/会社</th>
        <th *ngIf="hasBonusColumn()">賞与 健康保険<br>本人/会社</th>
        <th *ngIf="hasBonusColumn()">賞与 介護保険<br>本人/会社</th>
        <th *ngIf="hasBonusColumn()">賞与 厚生年金<br>本人/会社</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of getTableRows()" [ngClass]="{ 'exempt-row': row.monthlyPremium?.isExempt }">
        <td>{{ row.employee.name }}</td>
        <td>
          <span *ngIf="row.monthlyPremium?.isExempt" style="color: #ff6b00; font-weight: bold;">免除中</span>
          <span *ngIf="!row.monthlyPremium?.isExempt">
            {{ row.monthlyTotal.healthEmployee | number:'1.0-0' }} / {{ row.monthlyTotal.healthEmployer | number:'1.0-0' }}
          </span>
        </td>
        <td>
          <span *ngIf="row.monthlyPremium?.isExempt" style="color: #ff6b00; font-weight: bold;">免除中</span>
          <span *ngIf="!row.monthlyPremium?.isExempt">
            {{ row.monthlyTotal.careEmployee | number:'1.0-0' }} / {{ row.monthlyTotal.careEmployer | number:'1.0-0' }}
          </span>
        </td>
        <td>
          <span *ngIf="row.monthlyPremium?.isExempt" style="color: #ff6b00; font-weight: bold;">免除中</span>
          <span *ngIf="!row.monthlyPremium?.isExempt">
            {{ row.monthlyTotal.pensionEmployee | number:'1.0-0' }} / {{ row.monthlyTotal.pensionEmployer | number:'1.0-0' }}
          </span>
        </td>
        <td *ngIf="hasBonusColumn()">
          <span *ngIf="row.bonusPremium">
            <span *ngIf="row.bonusPremium.isExempted">免除中</span>
            <span *ngIf="!row.bonusPremium.isExempted">
              {{ row.bonusTotal.healthEmployee | number:'1.0-0' }} / {{ row.bonusTotal.healthEmployer | number:'1.0-0' }}
            </span>
          </span>
          <span *ngIf="!row.bonusPremium">-</span>
        </td>
        <td *ngIf="hasBonusColumn()">
          <span *ngIf="row.bonusPremium">
            <span *ngIf="row.bonusPremium.isExempted">免除中</span>
            <span *ngIf="!row.bonusPremium.isExempted">
              {{ row.bonusTotal.careEmployee | number:'1.0-0' }} / {{ row.bonusTotal.careEmployer | number:'1.0-0' }}
            </span>
          </span>
          <span *ngIf="!row.bonusPremium">-</span>
        </td>
        <td *ngIf="hasBonusColumn()">
          <span *ngIf="row.bonusPremium">
            <span *ngIf="row.bonusPremium.isExempted">免除中</span>
            <span *ngIf="!row.bonusPremium.isExempted">
              {{ row.bonusTotal.pensionEmployee | number:'1.0-0' }} / {{ row.bonusTotal.pensionEmployer | number:'1.0-0' }}
            </span>
          </span>
          <span *ngIf="!row.bonusPremium">-</span>
        </td>
      </tr>
      <tr *ngIf="getTableRows().length === 0" class="no-data-row">
        <td [attr.colspan]="hasBonusColumn() ? 7 : 4" style="text-align: center; padding: 1rem;">データがありません</td>
      </tr>
    </tbody>
  </table>
</div>
