<h2>月次給与・報酬入力</h2>

<div style="margin-bottom: 1rem;">
  <label>都道府県：</label>
  <select [(ngModel)]="prefecture" (change)="reloadRates()" name="prefecture">
    <option value="tokyo">東京都</option>
    <option value="hokkaido">北海道</option>
    <option value="osaka">大阪府</option>
  </select>
</div>

<table class="salary-table">
  <thead>
    <tr>
      <th>従業員</th>
      <th *ngFor="let m of months">{{ m }}月</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let emp of employees">
      <td>{{ emp.name }}</td>
      <td *ngFor="let m of months">
        <input
          type="number"
          [value]="salaries[getSalaryKey(emp.id, m)] || ''"
          (input)="onSalaryChange(emp.id, m, $any($event.target).value)"
          style="width: 80px;"
        />
      </td>
    </tr>
  </tbody>
</table>

<ng-container *ngFor="let emp of employees">
  <div class="result-card" *ngIf="getCalculatedInfo(emp) as info">
    <h4>{{ emp.name }} の計算結果</h4>

    <p><strong>4〜6月の平均報酬:</strong> {{ info.avg | number:'1.0-0' }} 円</p>
    <p><strong>標準報酬月額:</strong> {{ info.standard | number:'1.0-0' }} 円（等級: {{ info.rank }}）</p>

    <div class="premium-group" *ngIf="info.premiums">
      <h5>健康保険</h5>
      <p>本人: {{ info.premiums.health_employee | number:'1.0-0' }} 円</p>
      <p>事業主: {{ info.premiums.health_employer | number:'1.0-0' }} 円</p>
    </div>

    <div class="premium-group" *ngIf="info.premiums && info.premiums.care_employee !== null && info.premiums.care_employee !== 0">
      <h5>介護保険</h5>
      <p>本人: {{ info.premiums.care_employee | number:'1.0-0' }} 円</p>
      <p>事業主: {{ info.premiums.care_employer | number:'1.0-0' }} 円</p>
    </div>

    <div class="premium-group" *ngIf="info.premiums">
      <h5>厚生年金</h5>
      <p>本人: {{ info.premiums.pension_employee | number:'1.0-0' }} 円</p>
      <p>事業主: {{ info.premiums.pension_employer | number:'1.0-0' }} 円</p>
    </div>
  </div>
</ng-container>

<button (click)="saveAllSalaries()" style="margin-top: 1rem; padding: 0.5rem 1rem; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
  保存する
</button>

