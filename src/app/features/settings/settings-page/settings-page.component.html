<h2>設定・マスタ</h2>

<!-- 初回案内モーダル -->
<div
  *ngIf="showOnboardingGuide"
  style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.45);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    padding: 1rem;
  "
>
  <div
    style="
      background: #fff;
      max-width: 520px;
      width: 100%;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      padding: 1.5rem;
    "
  >
    <h3 style="margin-top: 0; margin-bottom: 0.75rem">初期設定のご案内</h3>
    <p style="margin-bottom: 1rem; line-height: 1.6">
      始めに以下の登録を済ませてから、従業員登録→報酬入力を進めてください。<br />
      <br />
      ■設定・マスタ<br />
      　・保険料率の設定<br />
      　・標準報酬月額テーブル<br />
      　・給与項目マスタ<br />
      　・事業所マスタ
    </p>
    <div style="text-align: right">
      <button class="btn-primary" (click)="closeOnboardingGuide()">閉じる</button>
    </div>
  </div>
</div>

<!-- タブナビゲーション -->
<div class="tabs">
  <button
    type="button"
    class="tab-button"
    [class.active]="activeTab === 'rate'"
    (click)="activeTab = 'rate'"
  >
    保険料率の設定
  </button>
  <button
    type="button"
    class="tab-button"
    [class.active]="activeTab === 'standard'"
    (click)="activeTab = 'standard'"
  >
    標準報酬月額テーブル
  </button>
  <button
    type="button"
    class="tab-button"
    [class.active]="activeTab === 'salaryItems'"
    (click)="activeTab = 'salaryItems'"
  >
    給与項目マスタ
  </button>
  <button
    type="button"
    class="tab-button"
    [class.active]="activeTab === 'office'"
    (click)="activeTab = 'office'"
  >
    事業所マスタ編集
  </button>
  <button
    type="button"
    class="tab-button"
    [class.active]="activeTab === 'editLog'"
    (click)="onEditLogTabClick()"
  >
    編集ログ
  </button>
  <button
    type="button"
    class="tab-button"
    [class.active]="activeTab === 'userRoom'"
    (click)="activeTab = 'userRoom'"
  >
    ユーザー・ルーム情報
  </button>
</div>

<!-- タブコンテンツ -->
<div class="tab-content">
  <!-- 保険料率の設定タブ -->
  <div *ngIf="activeTab === 'rate'" class="tab-pane">
    <div class="card">
      <div class="info-label">
        対象期間ごとに使用する社会保険料率（健保・介護・厚年）を登録してください。
      </div>
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1rem;
        "
      >
        <div class="form-group" style="margin-bottom: 0">
          <label>対象期間：</label>
          <select
            [(ngModel)]="year"
            (change)="onYearChange()"
            class="form-control"
            [ngModelOptions]="{ standalone: true }"
          >
            <option *ngFor="let y of availableYears" [value]="y.toString()">
              {{ y }}年3月-{{ y + 1 }}年2月
            </option>
          </select>
        </div>
      </div>

      <!-- 健康保険（47都道府県） -->
      <h3>健康保険（協会けんぽ）</h3>
      <div
        style="
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
          margin-bottom: 1.5rem;
        "
      >
        <!-- 左列 -->
        <div style="overflow-x: auto">
          <table class="rate-table">
            <thead>
              <tr>
                <th style="min-width: 100px">都道府県</th>
                <th style="min-width: 80px">健保_本人</th>
                <th style="min-width: 80px">健保_会社</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let pref of getPrefectureListColumn1()">
                <td>{{ pref.name }}</td>
                <td>
                  <div style="display: flex; align-items: center">
                    <input
                      type="number"
                      [value]="
                        formatHealthRate(
                          prefectureRates[pref.code]?.health_employee || 0
                        )
                      "
                      (input)="onHealthEmployeeInput(pref.code, $event)"
                      (blur)="savePrefectureRate(pref.code)"
                      class="form-control rate-input"
                      min="0"
                      max="100"
                      step="0.001"
                    />
                    <span
                      style="font-size: 0.85rem; color: #666; margin-left: 4px"
                      >%</span
                    >
                  </div>
                </td>
                <td>
                  <div style="display: flex; align-items: center">
                    <input
                      type="number"
                      [value]="
                        formatHealthRate(
                          prefectureRates[pref.code]?.health_employer || 0
                        )
                      "
                      (input)="onHealthEmployerInput(pref.code, $event)"
                      (blur)="savePrefectureRate(pref.code)"
                      class="form-control rate-input"
                      min="0"
                      max="100"
                      step="0.001"
                    />
                    <span
                      style="font-size: 0.85rem; color: #666; margin-left: 4px"
                      >%</span
                    >
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- 右列 -->
        <div style="overflow-x: auto">
          <table class="rate-table">
            <thead>
              <tr>
                <th style="min-width: 100px">都道府県</th>
                <th style="min-width: 80px">健保_本人</th>
                <th style="min-width: 80px">健保_会社</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let pref of getPrefectureListColumn2()">
                <td>{{ pref.name }}</td>
                <td>
                  <div style="display: flex; align-items: center">
                    <input
                      type="number"
                      [value]="
                        formatHealthRate(
                          prefectureRates[pref.code]?.health_employee || 0
                        )
                      "
                      (input)="onHealthEmployeeInput(pref.code, $event)"
                      (blur)="savePrefectureRate(pref.code)"
                      class="form-control rate-input"
                      min="0"
                      max="100"
                      step="0.001"
                    />
                    <span
                      style="font-size: 0.85rem; color: #666; margin-left: 4px"
                      >%</span
                    >
                  </div>
                </td>
                <td>
                  <div style="display: flex; align-items: center">
                    <input
                      type="number"
                      [value]="
                        formatHealthRate(
                          prefectureRates[pref.code]?.health_employer || 0
                        )
                      "
                      (input)="onHealthEmployerInput(pref.code, $event)"
                      (blur)="savePrefectureRate(pref.code)"
                      class="form-control rate-input"
                      min="0"
                      max="100"
                      step="0.001"
                    />
                    <span
                      style="font-size: 0.85rem; color: #666; margin-left: 4px"
                      >%</span
                    >
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- 介護保険（全国一律） -->
      <h3 style="text-align: left">介護保険（全国一律）</h3>
      <div class="card" style="margin-bottom: 1.5rem">
        <div class="form-group" style="text-align: left">
          <label>本人料率：</label>
          <div style="display: flex; align-items: center">
            <input
              type="number"
              [(ngModel)]="careRates.care_employee"
              class="form-control"
              min="0"
              max="100"
              step="0.0001"
              [ngModelOptions]="{ standalone: true }"
            />
            <span style="font-size: 0.85rem; color: #666; margin-left: 4px"
              >%</span
            >
          </div>
        </div>
        <div class="form-group" style="text-align: left">
          <label>事業主料率：</label>
          <div style="display: flex; align-items: center">
            <input
              type="number"
              [(ngModel)]="careRates.care_employer"
              class="form-control"
              min="0"
              max="100"
              step="0.0001"
              [ngModelOptions]="{ standalone: true }"
            />
            <span style="font-size: 0.85rem; color: #666; margin-left: 4px"
              >%</span
            >
          </div>
        </div>
      </div>

      <!-- 厚生年金（全国一律） -->
      <h3 style="text-align: left">厚生年金（全国一律）</h3>
      <div class="card" style="margin-bottom: 1.5rem">
        <div class="form-group" style="text-align: left">
          <label>本人料率：</label>
          <div style="display: flex; align-items: center">
            <input
              type="number"
              [(ngModel)]="pensionRates.pension_employee"
              class="form-control"
              min="0"
              max="100"
              step="0.0001"
              [ngModelOptions]="{ standalone: true }"
            />
            <span style="font-size: 0.85rem; color: #666; margin-left: 4px"
              >%</span
            >
          </div>
        </div>
        <div class="form-group" style="text-align: left">
          <label>事業主料率：</label>
          <div style="display: flex; align-items: center">
            <input
              type="number"
              [(ngModel)]="pensionRates.pension_employer"
              class="form-control"
              min="0"
              max="100"
              step="0.0001"
              [ngModelOptions]="{ standalone: true }"
            />
            <span style="font-size: 0.85rem; color: #666; margin-left: 4px"
              >%</span
            >
          </div>
        </div>
      </div>

      <!-- CSVインポート機能 -->
      <div class="card" style="margin-top: 1rem; padding: 1rem">
        <h4>CSVインポート</h4>
        <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem">
          CSV形式で都道府県別の料率を一括インポートできます。※パーセント形式で入力してください<br />
          入力例<br />
          都道府県,従業員負担,会社負担<br />
          北海道,5.155,5.155<br />
          青森県,4.925,4.925
        </p>

        <!-- テキストエリア -->
        <div
          style="
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 4px;
          "
        >
          <label for="csvText">CSVデータを貼り付けてください:</label>
          <textarea
            id="csvText"
            [(ngModel)]="csvImportText"
            rows="10"
            class="form-control"
            style="
              font-family: monospace;
              font-size: 0.9rem;
              margin-top: 0.5rem;
            "
            placeholder="都道府県,従業員負担,会社負担&#10;北海道,5.155,5.155&#10;青森県,5.155,5.155"
            [ngModelOptions]="{ standalone: true }"
          >
          </textarea>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem">
            <button
              (click)="importFromText()"
              class="btn-success"
              [ngClass]="{ 'btn-saving': isImportingRates }"
              [disabled]="isImportingRates"
            >
              {{ isImportingRates ? "インポート中..." : "インポート" }}
            </button>
          </div>
        </div>

        <!-- インポート結果メッセージ -->
        <div
          *ngIf="importResult"
          style="margin-top: 1rem; padding: 0.75rem; border-radius: 4px"
          [ngClass]="{
            'error-box': importResult.type === 'error',
            'info-label': importResult.type === 'success'
          }"
        >
          <strong
            >{{ importResult.type === "error" ? "エラー" : "成功" }}:</strong
          >
          {{ importResult.message }}
        </div>
      </div>

      <div
        class="button-group"
        style="margin-top: 1rem; margin-bottom: 1rem; display: flex; gap: 1rem"
      >
        <button
          (click)="saveAllRates()"
          class="btn-primary"
          [ngClass]="{ 'btn-saving': isSavingRates }"
          [disabled]="isSavingRates"
        >
          {{ isSavingRates ? "保存中..." : "すべての料率を保存する" }}
        </button>
        <button (click)="clearAllRates()" class="btn-danger">
          すべての料率をクリア
        </button>
      </div>
    </div>
  </div>

  <!-- 標準報酬月額テーブルタブ -->
  <div *ngIf="activeTab === 'standard'" class="tab-pane">
    <div class="card">
      <div class="info-label">標準報酬月額の等級表を設定してください。</div>
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1rem;
        "
      >
        <div class="form-group" style="margin-bottom: 0">
          <label>対象期間：</label>
          <select
            [(ngModel)]="gradeYear"
            (change)="onGradeYearChange()"
            class="form-control"
            [ngModelOptions]="{ standalone: true }"
          >
            <option
              *ngFor="let y of availableGradeYears"
              [value]="y.toString()"
            >
              {{ y }}年3月-{{ y + 1 }}年2月
            </option>
          </select>
        </div>
        <span style="font-size: 0.85rem; color: #666">単位：円</span>
      </div>
      <form [formGroup]="standardTableForm">
        <div formArrayName="standardTable">
          <table class="grade-table">
            <thead>
              <tr>
                <th>等級</th>
                <th>標準報酬月額</th>
                <th>下限</th>
                <th>上限</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let row of standardTable.controls; let i = index"
                [formGroupName]="i"
              >
                <td>{{ row.get("rank")?.value }}</td>
                <td>
                  <input
                    type="text"
                    [value]="getAmountDisplayValue(i, 'standard')"
                    (input)="onAmountInput(i, 'standard', $event)"
                    (blur)="onAmountBlur(i, 'standard', $event)"
                    class="form-control"
                  />
                </td>
                <td>
                  <input
                    type="text"
                    [value]="getAmountDisplayValue(i, 'lower')"
                    (input)="onAmountInput(i, 'lower', $event)"
                    (blur)="onAmountBlur(i, 'lower', $event)"
                    class="form-control"
                  />
                </td>
                <td>
                  <input
                    type="text"
                    [value]="getAmountDisplayValue(i, 'upper')"
                    (input)="onAmountInput(i, 'upper', $event)"
                    (blur)="onAmountBlur(i, 'upper', $event)"
                    class="form-control"
                  />
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </form>

      <!-- CSVインポート機能 -->
      <div class="card" style="margin-top: 1rem; padding: 1rem">
        <h4>CSVインポート</h4>
        <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem">
          CSV形式で標準報酬月額テーブルを一括インポートできます。<br />
          <br />
          例<br />
          等級,標準報酬月額(円),報酬月額下限(円),報酬月額上限(円未満)<br />
          30,500000,485000,515000
        </p>

        <!-- テキストエリア -->
        <div
          style="
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 4px;
          "
        >
          <label for="standardTableCsvText"
            >CSVデータを貼り付けてください:</label
          >
          <textarea
            id="standardTableCsvText"
            [(ngModel)]="standardTableCsvImportText"
            rows="10"
            class="form-control"
            style="
              font-family: monospace;
              font-size: 0.9rem;
              margin-top: 0.5rem;
            "
            placeholder="等級,標準報酬月額(円),報酬月額下限(円),報酬月額上限(円未満)&#10;1,58000,0,63000&#10;2,68000,63000,73000"
            [ngModelOptions]="{ standalone: true }"
          >
          </textarea>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem">
            <button (click)="importStandardTableFromText()" class="btn-success">
              インポート
            </button>
          </div>
        </div>

        <!-- インポート結果メッセージ -->
        <div
          *ngIf="standardTableImportResult"
          style="margin-top: 1rem; padding: 0.75rem; border-radius: 4px"
          [ngClass]="{
            'error-box': standardTableImportResult.type === 'error',
            'info-label': standardTableImportResult.type === 'success'
          }"
        >
          <strong
            >{{
              standardTableImportResult.type === "error" ? "エラー" : "成功"
            }}:</strong
          >
          {{ standardTableImportResult.message }}
        </div>
      </div>

      <!-- エラー・警告メッセージ -->
      <div *ngIf="errorMessages?.length" class="error-box">
        <h4>エラー</h4>
        <ul>
          <li *ngFor="let err of errorMessages">{{ err }}</li>
        </ul>
      </div>

      <div *ngIf="warningMessages?.length" class="warning-box">
        <h4>警告</h4>
        <ul>
          <li *ngFor="let w of warningMessages">{{ w }}</li>
        </ul>
      </div>

      <div style="margin-top: 1rem; display: flex; gap: 1rem">
        <button
          (click)="saveStandardTable()"
          class="btn-primary"
          [ngClass]="{ 'btn-saving': isSavingStandardTable }"
          [disabled]="isSavingStandardTable"
        >
          {{
            isSavingStandardTable
              ? "保存中..."
              : "標準報酬月額テーブルを保存する"
          }}
        </button>
        <button (click)="clearStandardTable()" class="btn-danger">
          テーブルをクリア
        </button>
      </div>
    </div>
  </div>

  <!-- 給与項目マスタタブ -->
  <div *ngIf="activeTab === 'salaryItems'" class="tab-pane">
    <div class="card">
      <div class="info-label">
        給与項目を「固定」「非固定」「欠勤控除」で分類して管理します。<br />
        （例　基本給：固定、残業：非固定）
      </div>
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1rem;
        "
      >
        <div class="form-group" style="margin-bottom: 0">
          <label>年度：</label>
          <select
            [(ngModel)]="salaryItemsYear"
            (change)="onSalaryItemsYearChange()"
            class="form-control"
            [ngModelOptions]="{ standalone: true }"
          >
            <option *ngFor="let y of getAvailableYears()" [value]="y">
              {{ y }}年
            </option>
          </select>
        </div>
      </div>
      <form [formGroup]="salaryItemsForm">
        <div formArrayName="salaryItems">
          <table
            class="salary-items-table"
            style="width: 100%; border-collapse: collapse; margin-top: 1rem"
          >
            <thead>
              <tr>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 2px solid #ddd;
                    background-color: #f5f5f5;
                  "
                >
                  項目名
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 2px solid #ddd;
                    background-color: #f5f5f5;
                  "
                >
                  種別
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: center;
                    border-bottom: 2px solid #ddd;
                    background-color: #f5f5f5;
                  "
                >
                  削除
                </th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let item of salaryItems.controls; let i = index"
                [formGroupName]="i"
              >
                <td style="padding: 8px; border-bottom: 1px solid #eee">
                  <input
                    type="text"
                    formControlName="name"
                    class="form-control"
                    placeholder="例：基本給"
                    required
                    style="width: 100%"
                  />
                </td>
                <td style="padding: 8px; border-bottom: 1px solid #eee">
                  <select
                    formControlName="type"
                    class="form-control"
                    required
                    style="width: 100%"
                    (change)="onSalaryItemTypeChange(i)"
                  >
                    <option value="fixed">固定</option>
                    <option value="variable">非固定</option>
                    <option value="deduction">欠勤控除</option>
                  </select>
                </td>
                <td
                  style="
                    padding: 8px;
                    border-bottom: 1px solid #eee;
                    text-align: center;
                  "
                >
                  <button
                    type="button"
                    (click)="removeSalaryItem(i)"
                    class="btn-danger"
                  >
                    削除
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </form>
      <button
        type="button"
        (click)="addSalaryItem()"
        class="btn-success"
        style="margin-top: 1rem"
      >
        項目を追加
      </button>
      <button
        type="button"
        (click)="saveSalaryItems()"
        class="btn-primary"
        style="margin-top: 1rem; margin-left: 0.5rem"
      >
        給与項目マスタを保存する
      </button>
    </div>
  </div>

  <!-- 事業所マスタ編集タブ -->
  <div *ngIf="activeTab === 'office'" class="tab-pane">
    <div class="card">
      <div class="info-label">
        事業所整理記号・事業所番号・法人番号・事業所所在地の都道府県・事業主氏名などの情報を管理します。
      </div>

      <!-- 事業所一覧 -->
      <div class="office-master-grid">
        <div class="card office-list-card">
          <h3 style="margin-top: 0">事業所一覧</h3>
          <div
            *ngIf="offices.length === 0"
            style="padding: 1rem; text-align: center; color: #666"
          >
            事業所が登録されていません
          </div>
          <div
            *ngFor="let office of offices"
            (click)="selectOffice(office)"
            [class]="
              selectedOffice?.id === office.id
                ? 'office-item selected'
                : 'office-item'
            "
            style="
              padding: 0.75rem;
              margin-bottom: 0.5rem;
              border: 1px solid #ddd;
              border-radius: 4px;
              cursor: pointer;
              background: #fff;
              transition: background-color 0.2s;
            "
          >
            <div style="font-weight: bold">
              {{ office.officeCode || "-" }}-{{ office.officeNumber || "-" }}
            </div>
            <div style="font-size: 0.9rem; color: #666; margin-top: 0.25rem">
              {{ office.address || "住所未設定" }}
            </div>
            <div style="font-size: 0.85rem; color: #999; margin-top: 0.25rem">
              {{ office.ownerName || "事業主名未設定" }}
            </div>
          </div>
        </div>

        <!-- 事業所編集フォーム -->
        <div class="card office-form-card">
          <h3 style="margin-top: 0">
            {{ selectedOffice ? "事業所情報の編集" : "事業所情報の新規登録" }}
          </h3>
          <form [formGroup]="officeForm">
            <div class="form-group">
              <label for="officeCode">事業所整理記号</label>
              <input
                id="officeCode"
                formControlName="officeCode"
                type="text"
                class="form-control"
                placeholder="例：01-イロハ"
              />
            </div>

            <div class="form-group">
              <label for="officeNumber">事業所番号</label>
              <input
                id="officeNumber"
                formControlName="officeNumber"
                type="text"
                class="form-control"
                placeholder="例：12345"
              />
            </div>

            <div class="form-group">
              <label for="corporateNumber">法人番号</label>
              <input
                id="corporateNumber"
                formControlName="corporateNumber"
                type="text"
                class="form-control"
                placeholder="例：12345678901"
              />
            </div>

            <div class="form-group">
              <label for="prefecture">事業所　所在都道府県</label>
              <select
                id="prefecture"
                formControlName="prefecture"
                class="form-control"
              >
                <option *ngFor="let pref of prefectureList" [value]="pref.code">
                  {{ pref.name }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label for="address">事業所　所在地</label>
              <textarea
                id="address"
                formControlName="address"
                class="form-control"
                rows="3"
                placeholder="例：〒123-4567 東京都千代田区丸の内1-1-1"
              ></textarea>
            </div>

            <div class="form-group">
              <label for="officeName">事業所　名称</label>
              <input
                id="officeName"
                formControlName="officeName"
                type="text"
                class="form-control"
                placeholder="例：株式会社〇〇"
              />
            </div>

            <div class="form-group">
              <label for="ownerName">事業主　氏名</label>
              <input
                id="ownerName"
                formControlName="ownerName"
                type="text"
                class="form-control"
                placeholder="例：代表取締役社長　〇〇〇〇"
              />
            </div>

            <div class="form-group">
              <label for="phoneNumber">電話番号</label>
              <input
                id="phoneNumber"
                formControlName="phoneNumber"
                type="text"
                class="form-control"
                placeholder="例：03-5643-6789"
              />
            </div>

            <div style="display: flex; gap: 0.5rem; margin-top: 1rem">
              <button type="button" (click)="saveOffice()" class="btn-primary">
                保存
              </button>
              <button
                *ngIf="selectedOffice"
                type="button"
                (click)="deleteOffice(selectedOffice.id!)"
                class="btn-danger"
              >
                削除
              </button>
              <button
                type="button"
                (click)="selectOffice(null)"
                class="btn-secondary"
              >
                キャンセル
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- 編集ログタブ -->
  <div *ngIf="activeTab === 'editLog'" class="tab-pane">
    <div class="card">
      <div class="info-label">
        アプリ内の情報を追加、編集、削除した時のログを表示します。
      </div>

      <!-- フィルター -->
      <div
        style="
          display: flex;
          gap: 1rem;
          align-items: center;
          margin-top: 1rem;
          margin-bottom: 1rem;
          flex-wrap: wrap;
        "
      >
        <div class="form-group" style="margin-bottom: 0">
          <label>日付フィルター：</label>
          <input
            type="date"
            [(ngModel)]="filterDate"
            (change)="applyFilters()"
            class="form-control"
            [ngModelOptions]="{ standalone: true }"
            style="width: 200px"
          />
          <button
            *ngIf="filterDate"
            (click)="clearDateFilter()"
            class="btn-secondary"
            style="
              margin-left: 0.5rem;
              padding: 0.25rem 0.5rem;
              font-size: 0.85rem;
            "
          >
            クリア
          </button>
        </div>
        <div class="form-group" style="margin-bottom: 0">
          <label>ユーザーフィルター：</label>
          <select
            [(ngModel)]="filterUserName"
            (change)="applyFilters()"
            class="form-control"
            [ngModelOptions]="{ standalone: true }"
            style="width: 200px"
          >
            <option value="">すべて</option>
            <option
              *ngFor="let userName of availableUserNames"
              [value]="userName"
            >
              {{ userName }}
            </option>
          </select>
        </div>
      </div>

      <div
        *ngIf="isLoadingLogs"
        style="padding: 2rem; text-align: center; color: #666"
      >
        読み込み中...
      </div>

      <div
        *ngIf="!isLoadingLogs && filteredEditLogs.length === 0"
        style="padding: 2rem; text-align: center; color: #666"
      >
        編集ログがありません
      </div>

      <div
        *ngIf="!isLoadingLogs && filteredEditLogs.length > 0"
        style="overflow-x: auto"
      >
        <table
          class="edit-log-table"
          style="width: 100%; border-collapse: collapse"
        >
          <thead>
            <tr style="background-color: #f5f5f5">
              <th
                style="
                  padding: 12px;
                  text-align: left;
                  border-bottom: 2px solid #ddd;
                  min-width: 150px;
                "
              >
                日時
              </th>
              <th
                style="
                  padding: 12px;
                  text-align: left;
                  border-bottom: 2px solid #ddd;
                  min-width: 100px;
                "
              >
                ユーザー名
              </th>
              <th
                style="
                  padding: 12px;
                  text-align: left;
                  border-bottom: 2px solid #ddd;
                  min-width: 80px;
                "
              >
                操作
              </th>
              <th
                style="
                  padding: 12px;
                  text-align: left;
                  border-bottom: 2px solid #ddd;
                  min-width: 150px;
                "
              >
                対象
              </th>
              <th
                style="
                  padding: 12px;
                  text-align: left;
                  border-bottom: 2px solid #ddd;
                "
              >
                内容
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let log of filteredEditLogs"
              style="border-bottom: 1px solid #eee"
            >
              <td style="padding: 12px">{{ formatDateTime(log.timestamp) }}</td>
              <td style="padding: 12px">{{ log.userName }}</td>
              <td style="padding: 12px">
                <span
                  [ngSwitch]="log.action"
                  style="
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-size: 0.9rem;
                    font-weight: bold;
                  "
                  [ngClass]="{
                    'create-badge': log.action === 'create',
                    'update-badge': log.action === 'update',
                    'delete-badge': log.action === 'delete'
                  }"
                >
                  <span *ngSwitchCase="'create'" style="color: #28a745">{{
                    getActionLabel(log.action)
                  }}</span>
                  <span *ngSwitchCase="'update'" style="color: #007bff">{{
                    getActionLabel(log.action)
                  }}</span>
                  <span *ngSwitchCase="'delete'" style="color: #dc3545">{{
                    getActionLabel(log.action)
                  }}</span>
                  <span *ngSwitchDefault>{{ getActionLabel(log.action) }}</span>
                </span>
              </td>
              <td style="padding: 12px">{{ log.entityName || "-" }}</td>
              <td style="padding: 12px">
                <span *ngIf="log.oldValue && log.newValue">
                  {{ formatDescription(log) }}
                </span>
                <span *ngIf="!log.oldValue || !log.newValue">
                  {{ log.description }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ユーザー・ルーム情報タブ -->
  <div *ngIf="activeTab === 'userRoom'" class="tab-pane">
    <div class="card">
      <div class="info-label">
        現在ログインしているユーザー情報とルーム情報を表示します。
      </div>

      <!-- ユーザー情報セクション -->
      <h3 style="margin-top: 1.5rem; margin-bottom: 1rem; text-align: left">
        ユーザー情報
      </h3>
      <div class="card" style="margin-bottom: 1.5rem">
        <div class="form-group" style="text-align: left">
          <label>ユーザー名：</label>
          <div
            style="
              padding: 0.5rem;
              background-color: #f8f9fa;
              border-radius: 4px;
              min-height: 2rem;
            "
          >
            {{ currentUser?.displayName || "未設定" }}
          </div>
        </div>
        <div class="form-group" style="text-align: left">
          <label>メールアドレス：</label>
          <div
            style="
              padding: 0.5rem;
              background-color: #f8f9fa;
              border-radius: 4px;
              min-height: 2rem;
            "
          >
            {{ currentUser?.email || "未設定" }}
          </div>
        </div>
        <div class="form-group" style="text-align: left">
          <label>パスワード：</label>
          <div
            style="
              padding: 0.5rem;
              background-color: #f8f9fa;
              border-radius: 4px;
              min-height: 2rem;
              font-family: monospace;
            "
          >
            ********（セキュリティ上の理由により表示されません）
          </div>
        </div>
      </div>

      <!-- ルーム情報セクション -->
      <h3 style="margin-top: 1.5rem; margin-bottom: 1rem; text-align: left">
        ルーム情報
      </h3>
      <div class="card">
        <div class="form-group" style="text-align: left">
          <label>ルーム名（企業名）：</label>
          <div
            style="
              padding: 0.5rem;
              background-color: #f8f9fa;
              border-radius: 4px;
              min-height: 2rem;
            "
          >
            {{ roomInfo?.name || "未設定" }}
          </div>
        </div>
        <div class="form-group" style="text-align: left">
          <label>ルームID：</label>
          <div
            style="
              padding: 0.5rem;
              background-color: #f8f9fa;
              border-radius: 4px;
              min-height: 2rem;
              font-family: monospace;
            "
          >
            {{ roomInfo?.id || "未設定" }}
          </div>
        </div>
        <div class="form-group" style="text-align: left">
          <label>ルームパスワード：</label>
          <div
            style="
              padding: 0.5rem;
              background-color: #f8f9fa;
              border-radius: 4px;
              min-height: 2rem;
              font-family: monospace;
            "
          >
            {{ roomInfo?.password || "未設定" }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
